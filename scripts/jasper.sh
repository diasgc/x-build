#!/bin/bash

# TODO patch src/libjasper/CMakeLists.txt to support dual static-shared build

lib='jasper'
apt='jasper'
dsc='Image Processing/Coding Tool Kit'
lic='JasPer'
src='https://github.com/mdadams/jasper.git'
cfg='cmake'
eta='26'

cmake_static="BUILD_STATIC_LIBS"
cmake_bin="JAS_ENABLE_PROGRAMS"
cmake_config="-DBUILD_TESTING=OFF -DJAS_ENABLE_DOC=OFF"

dev_bra='master'
dev_vrs='3.0.0'
stb_bra=''
stb_vrs=''

lst_inc='jasper/*.h'
lst_lib='libjasper'
lst_bin='jasper multithread imgcmp imginfo'
lst_lic='COPYRIGHT.txt LICENSE.txt'
lst_pc='jasper.pc'

. xbuilder.sh

$host_mingw && cmake_config="-DWITH_STACK_PROTECTOR=OFF"

start

# patch 01 on src/libjasper/CMakeLists.txt to support dual static shared build
<<'XB64_PATCH'
LS0tIHNyYy9saWJqYXNwZXIvQ01ha2VMaXN0cy50eHQJMjAyMi0wMi0wMiAxNzoyMzo0Ny4zMzMwMDAwMDAgKzAwMD
AKKysrIHNyYy9saWJqYXNwZXIvQ01ha2VMaXN0cy50eHQJMjAyMi0wMi0wMiAxNzozODozNC44ODA3MTAyNTMgKzAw
MDAKQEAgLTE0OCw2NiArMTQ4LDcyIEBACiAJc2V0KGxpYmphc3Blcl9yYXNfc291cmNlcyAiIikKIGVuZGlmKCkKIA
otaWYoSkFTX0VOQUJMRV9TSEFSRUQpCi0Jc2V0KGxpYmphc3Blcl90eXBlIFNIQVJFRCkKLWVsc2UoKQotCXNldChs
aWJqYXNwZXJfdHlwZSBTVEFUSUMpCi1lbmRpZigpCi0KLWFkZF9saWJyYXJ5KGxpYmphc3BlciAke2xpYmphc3Blcl
90eXBlfQotCSR7bGliamFzcGVyX2hlYWRlcnN9Ci0JJHtsaWJqYXNwZXJfYmFzZV9zb3VyY2VzfQotCSR7bGliamFz
cGVyX2JtcF9zb3VyY2VzfQotCSR7bGliamFzcGVyX2pwMl9zb3VyY2VzfQotCSR7bGliamFzcGVyX2pwY19zb3VyY2
VzfQotCSR7bGliamFzcGVyX2pwZ19zb3VyY2VzfQotCSR7bGliamFzcGVyX2hlaWNfc291cmNlc30KLQkke2xpYmph
c3Blcl9taWZfc291cmNlc30KLQkke2xpYmphc3Blcl9wZ3hfc291cmNlc30KLQkke2xpYmphc3Blcl9wbm1fc291cm
Nlc30KLQkke2xpYmphc3Blcl9yYXNfc291cmNlc30KLSkKLQotIyBUaGUgSmFzUGVyIGluY2x1ZGUgZGlyZWN0b3Jp
ZXMgaW4gdGhlIHNvdXJjZSBhbmQgYnVpbGQgdHJlZSBtdXN0IGJlIGluY2x1ZGVkCi0jIGJlZm9yZSBhbnkgb3RoZX
IgZGlyZWN0b3JpZXMgdGhhdCBtYXkgY29udGFpbiB0aGUgaW5jbHVkZSBkaXJlY3RvcnkgZm9yIGFuCi0jIGFscmVh
ZHkgaW5zdGFsbGVkIHZlcnNpb24gb2YgdGhlIEphc1BlciBsaWJyYXJ5LgotIyBUaGUgUFJJVkFURSBzcGVjaWZpZX
IgaGFzIGJlZW4gdXNlZCBoZXJlIHRvIGZvcmNlIHRoZSBsaWJyYXJ5IHVzZXIgdG8gaGF2ZQotIyB0byBleHBsaWNp
dGx5IHNwZWNpZnkgdGhlIGluY2x1ZGUgZGlyZWN0b3JpZXMgZnJvbSB0aGUgc291cmNlIGFuZCBidWlsZCB0cmVlCi
0jIHNvIHRoYXQgdGhlIEJFRk9SRSBzcGVjaWZpZXIgY2FuIGFsc28gYmUgZW1wbG95ZWQgYnkgdGhlIGxpYnJhcnkg
dXNlci4KLXRhcmdldF9pbmNsdWRlX2RpcmVjdG9yaWVzKGxpYmphc3BlciBCRUZPUkUgUFJJVkFURQotICAiJHtDTU
FLRV9DVVJSRU5UX0JJTkFSWV9ESVJ9L2luY2x1ZGUiCi0gICIke0NNQUtFX0NVUlJFTlRfU09VUkNFX0RJUn0vaW5j
bHVkZSIKLSkKLQotc2V0X3RhcmdldF9wcm9wZXJ0aWVzKGxpYmphc3BlciBQUk9QRVJUSUVTCi0gIE9VVFBVVF9OQU
1FIGphc3BlciBMSU5LRVJfTEFOR1VBR0UgQykKLQotaWYoTVNWQykKLQl0YXJnZXRfY29tcGlsZV9kZWZpbml0aW9u
cyhsaWJqYXNwZXIgUFJJVkFURSBfQ1JUX1NFQ1VSRV9OT19XQVJOSU5HUykKLQl0YXJnZXRfY29tcGlsZV9kZWZpbm
l0aW9ucyhsaWJqYXNwZXIgUFJJVkFURSBfQ1JUX1NFQ1VSRV9OT19ERVBSRUNBVEUpCi0JdGFyZ2V0X2NvbXBpbGVf
ZGVmaW5pdGlvbnMobGliamFzcGVyIFBSSVZBVEUgX0NSVF9OT05TVERDX05PX0RFUFJFQ0FURSkKLWVuZGlmKCkKLQ
otaWYoVU5JWCkKLQlzZXRfdGFyZ2V0X3Byb3BlcnRpZXMobGliamFzcGVyIFBST1BFUlRJRVMKLQkgIFZFUlNJT04g
JHtKQVNfU09fTkFNRX0gU09WRVJTSU9OICR7SkFTX1NPX1ZFUlNJT059KQotZW5kaWYoKQotCi1pZihKQVNfRU5BQk
xFX1NIQVJFRCkKLQl0YXJnZXRfY29tcGlsZV9kZWZpbml0aW9ucyhsaWJqYXNwZXIgUFVCTElDIEpBU19CVUlMRElO
R19ETEwpCi1lbmRpZigpCi0KLWlmKEpBU19FTkFCTEVfRlVaWkVSKQotCW1lc3NhZ2UoIkVuYWJsaW5nIGxpYkZ1en
plciIpCi0JdGFyZ2V0X2NvbXBpbGVfb3B0aW9ucyhsaWJqYXNwZXIgUFVCTElDICItZnNhbml0aXplPWZ1enplciIp
Ci1lbmRpZigpCi0KLSMgSSBhbSBub3Qgc3VyZSB3aHkgdGhlIGZvbGxvd2luZyBsaW5lIGlzIG5lZWRlZCBmb3IgYn
VpbGRpbmcgYSBsaWJyYXJ5LCBidXQKLSMgTWFjT1NYIGRvZXMgY2Fubm90IGJ1aWxkIGEgc2hhcmVkIGxpYnJhcnkg
d2l0aG91dCB0aGlzIGxpbmUuCi0jIEkgdGhpbmsgdGhhdCB0aGlzIG1pZ2h0IGJlIG5lZWRlZCBpbiBvcmRlciBmb3
IgYSBzaGFyZWQgbGlicmFyeSB0bwotIyBiZSBtYXJrZWQgYXMgaGF2aW5nIGEgZGVwZW5kZW5jeSBvbiBhbm90aGVy
IHNoYXJlZCBsaWJyYXJ5LgotdGFyZ2V0X2xpbmtfbGlicmFyaWVzKGxpYmphc3BlciBQVUJMSUMgJHtKQVNfTElCSl
BFR19UQVJHRVR9ICR7SEVJRl9MSUJSQVJJRVN9Ci0gICR7TUFUSF9MSUJSQVJZfSAke1RIUkVBRF9MSUJSQVJZfSkK
K3NldCh0YXJnZXRfbGlicyBsaWJqYXNwZXIpCitpZihCVUlMRF9TSEFSRURfTElCUyBBTkQgQlVJTERfU1RBVElDX0
xJQlMpCisJbGlzdChBUFBFTkQgdGFyZ2V0X2xpYnMgbGliamFzcGVyLXN0YXRpYykKK2VuZGlmKCkKKworZm9yZWFj
aChsaWIgJHt0YXJnZXRfbGlic30pCisJaWYoJHtsaWJ9IE1BVENIRVMgInN0YXRpYyQiKQorCQlzZXQobGliamFzcG
VyX3R5cGUgU1RBVElDKQorCWVsc2UoKQorCQlzZXQobGliamFzcGVyX3R5cGUgIiIpCisJZW5kaWYoKQorCWFkZF9s
aWJyYXJ5KCR7bGlifSAke2xpYmphc3Blcl90eXBlfQorCQkke2xpYmphc3Blcl9oZWFkZXJzfQorCQkke2xpYmphc3
Blcl9iYXNlX3NvdXJjZXN9CisJCSR7bGliamFzcGVyX2JtcF9zb3VyY2VzfQorCQkke2xpYmphc3Blcl9qcDJfc291
cmNlc30KKwkJJHtsaWJqYXNwZXJfanBjX3NvdXJjZXN9CisJCSR7bGliamFzcGVyX2pwZ19zb3VyY2VzfQorCQkke2
xpYmphc3Blcl9oZWljX3NvdXJjZXN9CisJCSR7bGliamFzcGVyX21pZl9zb3VyY2VzfQorCQkke2xpYmphc3Blcl9w
Z3hfc291cmNlc30KKwkJJHtsaWJqYXNwZXJfcG5tX3NvdXJjZXN9CisJCSR7bGliamFzcGVyX3Jhc19zb3VyY2VzfQ
orCSkKKworCSMgVGhlIEphc1BlciBpbmNsdWRlIGRpcmVjdG9yaWVzIGluIHRoZSBzb3VyY2UgYW5kIGJ1aWxkIHRy
ZWUgbXVzdCBiZSBpbmNsdWRlZAorCSMgYmVmb3JlIGFueSBvdGhlciBkaXJlY3RvcmllcyB0aGF0IG1heSBjb250YW
luIHRoZSBpbmNsdWRlIGRpcmVjdG9yeSBmb3IgYW4KKwkjIGFscmVhZHkgaW5zdGFsbGVkIHZlcnNpb24gb2YgdGhl
IEphc1BlciBsaWJyYXJ5LgorCSMgVGhlIFBSSVZBVEUgc3BlY2lmaWVyIGhhcyBiZWVuIHVzZWQgaGVyZSB0byBmb3
JjZSB0aGUgbGlicmFyeSB1c2VyIHRvIGhhdmUKKwkjIHRvIGV4cGxpY2l0bHkgc3BlY2lmeSB0aGUgaW5jbHVkZSBk
aXJlY3RvcmllcyBmcm9tIHRoZSBzb3VyY2UgYW5kIGJ1aWxkIHRyZWUKKwkjIHNvIHRoYXQgdGhlIEJFRk9SRSBzcG
VjaWZpZXIgY2FuIGFsc28gYmUgZW1wbG95ZWQgYnkgdGhlIGxpYnJhcnkgdXNlci4KKwl0YXJnZXRfaW5jbHVkZV9k
aXJlY3Rvcmllcygke2xpYn0gQkVGT1JFIFBSSVZBVEUKKwkJIiR7Q01BS0VfQ1VSUkVOVF9CSU5BUllfRElSfS9pbm
NsdWRlIgorCQkiJHtDTUFLRV9DVVJSRU5UX1NPVVJDRV9ESVJ9L2luY2x1ZGUiCisJCSkKKworCXNldF90YXJnZXRf
cHJvcGVydGllcygke2xpYn0gUFJPUEVSVElFUworCQlPVVRQVVRfTkFNRSBqYXNwZXIgTElOS0VSX0xBTkdVQUdFIE
MpCisKKwlpZihNU1ZDKQorCQl0YXJnZXRfY29tcGlsZV9kZWZpbml0aW9ucygke2xpYn0gUFJJVkFURSBfQ1JUX1NF
Q1VSRV9OT19XQVJOSU5HUykKKwkJdGFyZ2V0X2NvbXBpbGVfZGVmaW5pdGlvbnMoJHtsaWJ9IFBSSVZBVEUgX0NSVF
9TRUNVUkVfTk9fREVQUkVDQVRFKQorCQl0YXJnZXRfY29tcGlsZV9kZWZpbml0aW9ucygke2xpYn0gUFJJVkFURSBf
Q1JUX05PTlNURENfTk9fREVQUkVDQVRFKQorCWVuZGlmKCkKKworCWlmKFVOSVgpCisJCXNldF90YXJnZXRfcHJvcG
VydGllcygke2xpYn0gUFJPUEVSVElFUworCQkJVkVSU0lPTiAke0pBU19TT19OQU1FfSBTT1ZFUlNJT04gJHtKQVNf
U09fVkVSU0lPTn0pCisJZW5kaWYoKQorCisJaWYobGliamFzcGVyX3R5cGUgU1RSRVFVQUwgIiIpCisJCXRhcmdldF
9jb21waWxlX2RlZmluaXRpb25zKCR7bGlifSBQVUJMSUMgSkFTX0JVSUxESU5HX0RMTCkKKwllbmRpZigpCisKKwlp
ZihKQVNfRU5BQkxFX0ZVWlpFUikKKwkJbWVzc2FnZSgiRW5hYmxpbmcgbGliRnV6emVyIikKKwkJdGFyZ2V0X2NvbX
BpbGVfb3B0aW9ucygke2xpYn0gUFVCTElDICItZnNhbml0aXplPWZ1enplciIpCisJZW5kaWYoKQorCisJIyBJIGFt
IG5vdCBzdXJlIHdoeSB0aGUgZm9sbG93aW5nIGxpbmUgaXMgbmVlZGVkIGZvciBidWlsZGluZyBhIGxpYnJhcnksIG
J1dAorCSMgTWFjT1NYIGRvZXMgY2Fubm90IGJ1aWxkIGEgc2hhcmVkIGxpYnJhcnkgd2l0aG91dCB0aGlzIGxpbmUu
CisJIyBJIHRoaW5rIHRoYXQgdGhpcyBtaWdodCBiZSBuZWVkZWQgaW4gb3JkZXIgZm9yIGEgc2hhcmVkIGxpYnJhcn
kgdG8KKwkjIGJlIG1hcmtlZCBhcyBoYXZpbmcgYSBkZXBlbmRlbmN5IG9uIGFub3RoZXIgc2hhcmVkIGxpYnJhcnku
CisJdGFyZ2V0X2xpbmtfbGlicmFyaWVzKCR7bGlifSBQVUJMSUMgJHtKQVNfTElCSlBFR19UQVJHRVR9ICR7SEVJRl
9MSUJSQVJJRVN9CisJJHtNQVRIX0xJQlJBUll9ICR7VEhSRUFEX0xJQlJBUll9KQorZW5kZm9yZWFjaCgpCiAKIGdl
bmVyYXRlX2V4cG9ydF9oZWFkZXIobGliamFzcGVyCiAgIEVYUE9SVF9GSUxFX05BTUUgaW5jbHVkZS9qYXNwZXIvam
FzX2V4cG9ydF9jbWFrZS5oCkBAIC0yMTYsNyArMjIyLDcgQEAKICAgTk9fRVhQT1JUX01BQ1JPX05BTUUgSkFTX0xP
Q0FMCiApCiAKLWluc3RhbGwoVEFSR0VUUyBsaWJqYXNwZXIKK2luc3RhbGwoVEFSR0VUUyAke3RhcmdldF9saWJzfQ
ogICBSVU5USU1FIERFU1RJTkFUSU9OICR7Q01BS0VfSU5TVEFMTF9CSU5ESVJ9CiAgIExJQlJBUlkgREVTVElOQVRJ
T04gJHtDTUFLRV9JTlNUQUxMX0xJQkRJUn0KICAgQVJDSElWRSBERVNUSU5BVElPTiAke0NNQUtFX0lOU1RBTExfTE
lCRElSfQo=
XB64_PATCH

# cpu av8 av7 x86 x64
# NDK +++  .   .   .  clang
# GNU  .   .   .   .  gcc
# WIN  .   .   .   .  clang/gcc


# Filelist
# --------
# include/jasper/jas_config.h
# include/jasper/jasper.h
# include/jasper/jas_string.h
# include/jasper/jas_math.h
# include/jasper/jas_log.h
# include/jasper/jas_compiler.h
# include/jasper/jas_thread.h
# include/jasper/jas_types.h
# include/jasper/jas_fix.h
# include/jasper/jas_getopt.h
# include/jasper/jas_tvp.h
# include/jasper/jas_tmr.h
# include/jasper/jas_dll.h
# include/jasper/jas_cm.h
# include/jasper/jas_malloc.h
# include/jasper/jas_init.h
# include/jasper/jas_export_cmake.h
# include/jasper/jas_version.h
# include/jasper/jas_debug.h
# include/jasper/jas_seq.h
# include/jasper/jas_icc.h
# include/jasper/jas_image.h
# include/jasper/jas_stream.h
# share/man/man1/imginfo.1
# share/man/man1/jasper.1
# share/man/man1/imgcmp.1
# share/doc/JasPer/README.md
# share/doc/jasper/LICENSE.txt
# share/doc/jasper/COPYRIGHT.txt
# lib/libjasper.so
# lib/libjasper.a
# lib/pkgconfig/jasper.pc
# bin/imginfo
# bin/imgcmp
# bin/jasper

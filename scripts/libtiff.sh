#!/bin/bash

lib='libtiff'
apt="${lib}-dev"
dsc='TIFF Library and Utilities'
vrs='v4.3.0'
lic='GPL?'
src='https://gitlab.com/libtiff/libtiff.git'
cfg='cmake'
pkg='libtiff-4'
eta='150'
dep='liblzma libjpeg libzstd libwebp libdeflate lerc'
mingw_posix=true

cmake_static='BUILD_STATIC_LIBS'
mkc='distclean'
mki='install/strip'

cmake_config="-Dlzma=ON -Djpeg=ON -Dzstd=ON -Dwebp=ON -Dlerc=ON -Dlibdeflate=ON"

lst_inc='tiffconf.h tiffvers.h tiff.h tiffio.hxx tiffio.h'
lst_lib='libtiffxx libtiff'
lst_bin='tiffmedian tiffset fax2ps tiff2bw tiffdither raw2tiff tiffsplit tiff2pdf fax2tiff tiff2rgba pal2rgb tiff2ps tiffcrop tiffcmp tiffinfo tiffcp tiffdump ppm2tiff'
lst_lic='COPYRIGHT'
lst_pc='libtiff-4.pc'


extraOpts(){
    case $1 in
        --min) unset dep cmake_config;;
    esac
}

. xbuilder.sh

start

# patch 01: support to dual static+shared build
# patch 02: add options BUILD_MAN(=OFF) and BUILD_HTML(=OFF) to build man and html pages
<<'XB64_PATCH'
LS0tIGxpYnRpZmYvQ01ha2VMaXN0cy50eHQJMjAyMi0wMS0yMyAyMzoxMDo1MS40MjIwMDAwMDAg
KzAwMDAKKysrIGxpYnRpZmYvQ01ha2VMaXN0cy50eHQJMjAyMi0wMS0yMyAyMzoxMTowNC4wMDUz
OTA2MDAgKzAwMDAKQEAgLTQ1LDYgKzQ1LDcgQEAKICAgICAgICAgJHtDTUFLRV9DVVJSRU5UX0JJ
TkFSWV9ESVJ9L3RpZl9jb25maWcuaCkKIAogCitzZXQodGlmZl90YXJnZXRzIHRpZmYpCiBhZGRf
bGlicmFyeSh0aWZmIGxpYnRpZmYuZGVmKQogCiB0YXJnZXRfc291cmNlcyh0aWZmIFBSSVZBVEUK
QEAgLTE1NywxMCArMTU4LDEyMSBAQAogaW5zdGFsbChGSUxFUyAke3RpZmZfcHVibGljX0hFQURF
UlN9CiAgICAgICAgIERFU1RJTkFUSU9OICIke0NNQUtFX0lOU1RBTExfRlVMTF9JTkNMVURFRElS
fSIpCiAKKyAgICAgICAgaWYoQlVJTERfU0hBUkVEX0xJQlMgQU5EIEJVSUxEX1NUQVRJQ19MSUJT
KQorICBhZGRfbGlicmFyeSh0aWZmX3N0YXRpYyBTVEFUSUMgbGlidGlmZi5kZWYpCisgIHNldF90
YXJnZXRfcHJvcGVydGllcyh0aWZmX3N0YXRpYyBQUk9QRVJUSUVTIE9VVFBVVF9OQU1FIHRpZmYp
CisgIHNldCh0aWZmX3RhcmdldHMgdGlmZiB0aWZmX3N0YXRpYykKKyAgdGFyZ2V0X3NvdXJjZXMo
dGlmZl9zdGF0aWMgUFJJVkFURQorICAgICAgICAke3RpZmZfcHVibGljX0hFQURFUlN9CisgICAg
ICAgICR7dGlmZl9wcml2YXRlX0hFQURFUlN9CisgICAgICAgIHRpZl9hdXguYworICAgICAgICB0
aWZfY2xvc2UuYworICAgICAgICB0aWZfY29kZWMuYworICAgICAgICB0aWZfY29sb3IuYworICAg
ICAgICB0aWZfY29tcHJlc3MuYworICAgICAgICB0aWZfZGlyLmMKKyAgICAgICAgdGlmX2Rpcmlu
Zm8uYworICAgICAgICB0aWZfZGlycmVhZC5jCisgICAgICAgIHRpZl9kaXJ3cml0ZS5jCisgICAg
ICAgIHRpZl9kdW1wbW9kZS5jCisgICAgICAgIHRpZl9lcnJvci5jCisgICAgICAgIHRpZl9leHRl
bnNpb24uYworICAgICAgICB0aWZfZmF4My5jCisgICAgICAgIHRpZl9mYXgzc20uYworICAgICAg
ICB0aWZfZmx1c2guYworICAgICAgICB0aWZfZ2V0aW1hZ2UuYworICAgICAgICB0aWZfamJpZy5j
CisgICAgICAgIHRpZl9qcGVnLmMKKyAgICAgICAgdGlmX2pwZWdfMTIuYworICAgICAgICB0aWZf
bGVyYy5jCisgICAgICAgIHRpZl9sdXYuYworICAgICAgICB0aWZfbHptYS5jCisgICAgICAgIHRp
Zl9sencuYworICAgICAgICB0aWZfbmV4dC5jCisgICAgICAgIHRpZl9vanBlZy5jCisgICAgICAg
IHRpZl9vcGVuLmMKKyAgICAgICAgdGlmX3BhY2tiaXRzLmMKKyAgICAgICAgdGlmX3BpeGFybG9n
LmMKKyAgICAgICAgdGlmX3ByZWRpY3QuYworICAgICAgICB0aWZfcHJpbnQuYworICAgICAgICB0
aWZfcmVhZC5jCisgICAgICAgIHRpZl9zdHJpcC5jCisgICAgICAgIHRpZl9zd2FiLmMKKyAgICAg
ICAgdGlmX3RodW5kZXIuYworICAgICAgICB0aWZfdGlsZS5jCisgICAgICAgIHRpZl92ZXJzaW9u
LmMKKyAgICAgICAgdGlmX3dhcm5pbmcuYworICAgICAgICB0aWZfd2VicC5jCisgICAgICAgIHRp
Zl93cml0ZS5jCisgICAgICAgIHRpZl96aXAuYworICAgICAgICB0aWZfenN0ZC5jKQorCisgIGlm
KFVTRV9XSU4zMl9GSUxFSU8pCisgICAgdGFyZ2V0X3NvdXJjZXModGlmZl9zdGF0aWMgUFJJVkFU
RSB0aWZfd2luMzIuYykKKyAgZWxzZSgpCisgICAgdGFyZ2V0X3NvdXJjZXModGlmZl9zdGF0aWMg
UFJJVkFURSB0aWZfdW5peC5jKQorICBlbmRpZigpCisKKyAgdGFyZ2V0X2luY2x1ZGVfZGlyZWN0
b3JpZXModGlmZl9zdGF0aWMKKyAgICAgIFBVQkxJQworICAgICAgICAgICQ8QlVJTERfSU5URVJG
QUNFOiR7Q01BS0VfQ1VSUkVOVF9TT1VSQ0VfRElSfT4KKyAgICAgICAgICAkPEJVSUxEX0lOVEVS
RkFDRToke0NNQUtFX0NVUlJFTlRfQklOQVJZX0RJUn0+CisgICAgICBQUklWQVRFCisgICAgICAg
ICAgJHtUSUZGX0lOQ0xVREVTfQorICApCisKKyAgaWYoWklQX1NVUFBPUlQpCisgICAgdGFyZ2V0
X2xpbmtfbGlicmFyaWVzKHRpZmZfc3RhdGljIFBSSVZBVEUgWkxJQjo6WkxJQikKKyAgZW5kaWYo
KQorICBpZihaSVBfU1VQUE9SVCBBTkQgTElCREVGTEFURV9TVVBQT1JUKQorICAgIHRhcmdldF9s
aW5rX2xpYnJhcmllcyh0aWZmX3N0YXRpYyBQUklWQVRFIERlZmxhdGU6OkRlZmxhdGUpCisgIGVu
ZGlmKCkKKyAgaWYoSlBFR19TVVBQT1JUKQorICAgIHRhcmdldF9saW5rX2xpYnJhcmllcyh0aWZm
X3N0YXRpYyBQUklWQVRFIEpQRUc6OkpQRUcpCisgICAgaWYoSlBFR19EVUFMX01PREVfOF8xMikK
KyAgICAgIHRhcmdldF9pbmNsdWRlX2RpcmVjdG9yaWVzKHRpZmZfc3RhdGljIFBSSVZBVEUgJHtK
UEVHMTJfSU5DTFVERV9ESVJ9KQorICAgICAgdGFyZ2V0X2xpbmtfbGlicmFyaWVzKHRpZmZfc3Rh
dGljIFBSSVZBVEUgJHtKUEVHMTJfTElCUkFSSUVTfSkKKyAgICBlbmRpZigpCisgIGVuZGlmKCkK
KyAgaWYoSkJJR19TVVBQT1JUKQorICAgIHRhcmdldF9saW5rX2xpYnJhcmllcyh0aWZmX3N0YXRp
YyBQUklWQVRFIEpCSUc6OkpCSUcpCisgIGVuZGlmKCkKKyAgaWYoTEVSQ19TVVBQT1JUKQorICAg
ICAgdGFyZ2V0X2xpbmtfbGlicmFyaWVzKHRpZmZfc3RhdGljIFBSSVZBVEUgTEVSQzo6TEVSQykK
KyAgZW5kaWYoKQorICBpZihMWk1BX1NVUFBPUlQpCisgICAgICB0YXJnZXRfbGlua19saWJyYXJp
ZXModGlmZl9zdGF0aWMgUFJJVkFURSBMaWJMWk1BOjpMaWJMWk1BKQorICBlbmRpZigpCisgIGlm
KFpTVERfU1VQUE9SVCkKKyAgICB0YXJnZXRfbGlua19saWJyYXJpZXModGlmZl9zdGF0aWMgUFJJ
VkFURSBaU1REOjpaU1REKQorICBlbmRpZigpCisgIGlmKFdFQlBfU1VQUE9SVCkKKyAgICB0YXJn
ZXRfbGlua19saWJyYXJpZXModGlmZl9zdGF0aWMgUFJJVkFURSBXZWJQOjpXZWJQKQorICBlbmRp
ZigpCisgIHRhcmdldF9saW5rX2xpYnJhcmllcyh0aWZmX3N0YXRpYyBQUklWQVRFIENNYXRoOjpD
TWF0aCkKKworICBzZXRfdGFyZ2V0X3Byb3BlcnRpZXModGlmZl9zdGF0aWMgUFJPUEVSVElFUyBT
T1ZFUlNJT04gJHtTT19DT01QQVRWRVJTSU9OfSkKKyAgaWYoTk9UIENZR1dJTikKKyAgICAgICMg
VGhpcyBwcm9wZXJ0eSBjYXVzZXMgc2hhcmVkIGxpYnJhcmllcyBvbiBMaW51eCB0byBoYXZlIHRo
ZSBmdWxsIHZlcnNpb24KKyAgICAgICMgZW5jb2RlZCBpbnRvIHRoZWlyIGZpbmFsIGZpbGVuYW1l
LiAgV2UgZGlzYWJsZSB0aGlzIG9uIEN5Z3dpbiBiZWNhdXNlCisgICAgICAjIGl0IGNhdXNlcyBj
eWd6LSR7VElGRl9GVUxMX1ZFUlNJT059LmRsbCB0byBiZSBjcmVhdGVkIHdoZW4gY3lnei5kbGwK
KyAgICAgICMgc2VlbXMgdG8gYmUgdGhlIGRlZmF1bHQuCisgICAgICBzZXRfdGFyZ2V0X3Byb3Bl
cnRpZXModGlmZl9zdGF0aWMgUFJPUEVSVElFUyBWRVJTSU9OICR7U09fVkVSU0lPTn0pCisgIGVu
ZGlmKCkKKyAgaWYoSEFWRV9MRF9WRVJTSU9OX1NDUklQVCkKKyAgICBzZXRfdGFyZ2V0X3Byb3Bl
cnRpZXModGlmZl9zdGF0aWMgUFJPUEVSVElFUyBMSU5LX0ZMQUdTCisgICAgICAgICAgICAgICAg
ICAgICAgICAgICItV2wsLS12ZXJzaW9uLXNjcmlwdD0ke0NNQUtFX0NVUlJFTlRfU09VUkNFX0RJ
Un0vbGlidGlmZi5tYXAiKQorICBlbmRpZigpCisgIGluc3RhbGwoVEFSR0VUUyB0aWZmX3N0YXRp
YworICAgICAgICBSVU5USU1FIERFU1RJTkFUSU9OICR7Q01BS0VfSU5TVEFMTF9GVUxMX0JJTkRJ
Un0KKyAgICAgICAgTElCUkFSWSBERVNUSU5BVElPTiAke0NNQUtFX0lOU1RBTExfRlVMTF9MSUJE
SVJ9CisgICAgICAgIEFSQ0hJVkUgREVTVElOQVRJT04gJHtDTUFLRV9JTlNUQUxMX0ZVTExfTElC
RElSfSkKK2VuZGlmKCkKKwogaWYoQ1hYX1NVUFBPUlQpCiAgIHNldCh0aWZmeHhfSEVBREVSUwog
ICAgICAgICAgIHRpZmZpby5oeHgpCi0KKyAgc2V0KHRpZmZ4eF90YXJnZXRzIHRpZmZ4eCkKICAg
YWRkX2xpYnJhcnkodGlmZnh4KQogICB0YXJnZXRfc291cmNlcyh0aWZmeHggUFJJVkFURQogICAg
ICAgICAgICR7dGlmZnh4X0hFQURFUlN9CkBAIC0xNzgsMTUgKzI5MCwzNSBAQAogICAgIHNldF90
YXJnZXRfcHJvcGVydGllcyh0aWZmeHggUFJPUEVSVElFUyBMSU5LX0ZMQUdTCiAgICAgICAgICAg
ICAgICAgICAgICAgICAgICItV2wsLS12ZXJzaW9uLXNjcmlwdD0ke0NNQUtFX0NVUlJFTlRfU09V
UkNFX0RJUn0vbGlidGlmZnh4Lm1hcCIpCiAgIGVuZGlmKCkKLQogICBpbnN0YWxsKFRBUkdFVFMg
dGlmZnh4Ci0gICAgICAgICAgUlVOVElNRSBERVNUSU5BVElPTiAke0NNQUtFX0lOU1RBTExfRlVM
TF9CSU5ESVJ9Ci0gICAgICAgICAgTElCUkFSWSBERVNUSU5BVElPTiAke0NNQUtFX0lOU1RBTExf
RlVMTF9MSUJESVJ9Ci0gICAgICAgICAgQVJDSElWRSBERVNUSU5BVElPTiAke0NNQUtFX0lOU1RB
TExfRlVMTF9MSUJESVJ9KQotCi0gIGluc3RhbGwoRklMRVMgJHt0aWZmeHhfSEVBREVSU30KLSAg
ICAgICAgICBERVNUSU5BVElPTiAiJHtDTUFLRV9JTlNUQUxMX0ZVTExfSU5DTFVERURJUn0iKQot
CisgIFJVTlRJTUUgREVTVElOQVRJT04gJHtDTUFLRV9JTlNUQUxMX0ZVTExfQklORElSfQorICBM
SUJSQVJZIERFU1RJTkFUSU9OICR7Q01BS0VfSU5TVEFMTF9GVUxMX0xJQkRJUn0KKyAgQVJDSElW
RSBERVNUSU5BVElPTiAke0NNQUtFX0lOU1RBTExfRlVMTF9MSUJESVJ9KQorCitpbnN0YWxsKEZJ
TEVTICR7dGlmZnh4X0hFQURFUlN9CisgIERFU1RJTkFUSU9OICIke0NNQUtFX0lOU1RBTExfRlVM
TF9JTkNMVURFRElSfSIpCisKKyAgaWYoQlVJTERfU0hBUkVEX0xJQlMgQU5EIEJVSUxEX1NUQVRJ
Q19MSUJTKQorICAgIGFkZF9saWJyYXJ5KHRpZmZ4eF9zdGF0aWMgU1RBVElDICR7dGlmZnh4X0hF
QURFUlN9IHRpZl9zdHJlYW0uY3h4KQorICAgIHNldF90YXJnZXRfcHJvcGVydGllcyh0aWZmeHhf
c3RhdGljIFBST1BFUlRJRVMgT1VUUFVUX05BTUUgdGlmZnh4KQorICAgIHRhcmdldF9saW5rX2xp
YnJhcmllcyh0aWZmeHhfc3RhdGljIHRpZmZfc3RhdGljKQorICAgIHNldF90YXJnZXRfcHJvcGVy
dGllcyh0aWZmeHhfc3RhdGljIFBST1BFUlRJRVMgU09WRVJTSU9OICR7U09fQ09NUEFUVkVSU0lP
Tn0pCisgICAgaWYoTk9UIENZR1dJTikKKyAgICAgICMgVGhpcyBwcm9wZXJ0eSBjYXVzZXMgc2hh
cmVkIGxpYnJhcmllcyBvbiBMaW51eCB0byBoYXZlIHRoZSBmdWxsIHZlcnNpb24KKyAgICAgICMg
ZW5jb2RlZCBpbnRvIHRoZWlyIGZpbmFsIGZpbGVuYW1lLiAgV2UgZGlzYWJsZSB0aGlzIG9uIEN5
Z3dpbiBiZWNhdXNlCisgICAgICAjIGl0IGNhdXNlcyBjeWd6LSR7VElGRl9GVUxMX1ZFUlNJT059
LmRsbCB0byBiZSBjcmVhdGVkIHdoZW4gY3lnei5kbGwKKyAgICAgICMgc2VlbXMgdG8gYmUgdGhl
IGRlZmF1bHQuCisgICAgICBzZXRfdGFyZ2V0X3Byb3BlcnRpZXModGlmZnh4X3N0YXRpYyBQUk9Q
RVJUSUVTIFZFUlNJT04gJHtTT19WRVJTSU9OfSkKKyAgICBlbmRpZigpCisgICAgaWYoSEFWRV9M
RF9WRVJTSU9OX1NDUklQVCkKKyAgICAgIHNldF90YXJnZXRfcHJvcGVydGllcyh0aWZmeHhfc3Rh
dGljIFBST1BFUlRJRVMgTElOS19GTEFHUworICAgICAgICAgICAgICAgICAgICAgICAgICAgICIt
V2wsLS12ZXJzaW9uLXNjcmlwdD0ke0NNQUtFX0NVUlJFTlRfU09VUkNFX0RJUn0vbGlidGlmZnh4
Lm1hcCIpCisgICAgZW5kaWYoKQorICAgIGluc3RhbGwoVEFSR0VUUyB0aWZmeHhfc3RhdGljCisg
ICAgICAgUlVOVElNRSBERVNUSU5BVElPTiAke0NNQUtFX0lOU1RBTExfRlVMTF9CSU5ESVJ9Cisg
ICAgICAgTElCUkFSWSBERVNUSU5BVElPTiAke0NNQUtFX0lOU1RBTExfRlVMTF9MSUJESVJ9Cisg
ICAgICAgQVJDSElWRSBERVNUSU5BVElPTiAke0NNQUtFX0lOU1RBTExfRlVMTF9MSUJESVJ9KQor
ICBlbmRpZigpCiBlbmRpZigpCiAKIGFkZF9leGVjdXRhYmxlKG1rZzNzdGF0ZXMpCgotLS0gQ01h
a2VMaXN0cy50eHQJMjAyMi0wMS0yMyAyMzoxMzo0OC42MDMwMDAwMDAgKzAwMDAKKysrIENNYWtl
TGlzdHMudHh0CTIwMjItMDEtMjMgMjM6MTU6MjEuNTg1MzkwNjAwICswMDAwCkBAIC0xNDEsOCAr
MTQxLDE0IEBACiBhZGRfc3ViZGlyZWN0b3J5KHRlc3QpCiBhZGRfc3ViZGlyZWN0b3J5KGNvbnRy
aWIpCiBhZGRfc3ViZGlyZWN0b3J5KGJ1aWxkKQotYWRkX3N1YmRpcmVjdG9yeShtYW4pCi1hZGRf
c3ViZGlyZWN0b3J5KGh0bWwpCitvcHRpb24oQlVJTERfTUFOICJidWlsZCBtYW4gcGFnZXMiIE9G
RikKK2lmKEJVSUxEX01BTikKKyAgYWRkX3N1YmRpcmVjdG9yeShtYW4pCitlbmRpZigpCitvcHRp
b24oQlVJTERfSFRNTCAiYnVpbGQgaHRtbCBwYWdlcyIgT0ZGKQoraWYoQlVJTERfSFRNTCkKKyAg
YWRkX3N1YmRpcmVjdG9yeShodG1sKQorZW5kaWYoKQogCiAKIG1lc3NhZ2UoU1RBVFVTICIiKQo=
XB64_PATCH

# Filelist
# --------
# include/tiffconf.h
# include/tiffvers.h
# include/tiff.h
# include/tiffio.hxx
# include/tiffio.h
# lib/pkgconfig/libtiff-4.pc
# lib/libtiffxx.a
# lib/libtiffxx.so
# lib/libtiff.so
# lib/libtiff.a
# share/doc/libtiff/COPYRIGHT
# bin/tiffmedian
# bin/tiffset
# bin/fax2ps
# bin/tiff2bw
# bin/tiffdither
# bin/raw2tiff
# bin/tiffsplit
# bin/tiff2pdf
# bin/fax2tiff
# bin/tiff2rgba
# bin/pal2rgb
# bin/tiff2ps
# bin/tiffcrop
# bin/tiffcmp
# bin/tiffinfo
# bin/tiffcp
# bin/tiffdump
# bin/ppm2tiff

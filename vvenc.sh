#!/bin/bash
# cpu av8 av7 x86 x64
# NDK +++ +++  .   .  clang
# GNU +++  .   .  +++ gcc
# WIN +++  .   .   .  clang/gcc

lib='vvenc'
pkg='libvvenc'
dsc='Fraunhofer Versatile Video Encoder'
lic='LGPL-2.1'
src='https://github.com/fraunhoferhhi/vvenc.git'
cfg='cmake'
eta='480'
cmake_bin="BUILD_TOOLS"

lst_inc='vvenc/*.h'
lst_lib='libvvenc'
lst_bin='vvencapp vvencFFapp'
lst_lic='AUTHORS.md LICENSE.txt'
lst_pc='libvvenc.pc'

dev_bra='master'
dev_vrs='1.3.1'

on_config_arm(){
  cmake_config+=' -DVVENC_ENABLE_X86_SIMD=FALSE -DVVENC_ENABLE_ARM_SIMD=TRUE'
}

. xbuild

start

# patch 01 on CMakeLists.txt to support arm build
# patch 02 on source/Lib/vvenc/CMakeLists.txt to remove -Werror
# patch 03 on source/Lib/vvenc/vvencimpl.cpp to support android build
# todo patch to support dual static+shared build
<<'XB64_PATCH'
LS0tIENNYWtlTGlzdHMudHh0CTIwMjEtMTAtMDggMTY6MTI6MDIuMTk4MDAwMDAwICswMTAwCisr
KyBDTWFrZUxpc3RzLnR4dAkyMDIxLTEwLTA4IDE2OjEyOjQxLjIwMDAwMDAwMCArMDEwMApAQCAt
MTIsOCArMTIsOCBAQAogIyBwcm9qZWN0IG5hbWUKIHByb2plY3QoIHZ2ZW5jIFZFUlNJT04gMS4x
LjAgKQogCi1zZXQoIFZWRU5DX0VOQUJMRV9YODZfU0lNRCBUUlVFICkKLXNldCggVlZFTkNfRU5B
QkxFX0FSTV9TSU1EIEZBTFNFICkKK29wdGlvbiggVlZFTkNfRU5BQkxFX1g4Nl9TSU1EICJlbmFi
bGUgeDg2IGludHJpbnNpY3MiIFRSVUUpCitvcHRpb24oIFZWRU5DX0VOQUJMRV9BUk1fU0lNRCAi
ZW5hYmxlIGFybSBpbnRyaW5zaWNzIiBGQUxTRSApCiAKIGlmKCBBUFBMRSApCiAgIGlmKCBERUZJ
TkVEIENNQUtFX09TWF9BUkNISVRFQ1RVUkVTICkKCi0tLSBzb3VyY2UvTGliL3Z2ZW5jL0NNYWtl
TGlzdHMudHh0CTIwMjItMDItMjQgMjI6NTE6MzYuNzczMDYzMDAwICswMDAwCisrKyBzb3VyY2Uv
TGliL3Z2ZW5jL0NNYWtlTGlzdHMudHh0CTIwMjItMDItMjQgMjI6NTI6NDcuMjIzMDYzMDAwICsw
MDAwCkBAIC04OSw4ICs4OSw4IEBACiB0YXJnZXRfY29tcGlsZV9kZWZpbml0aW9ucyggJHtMSUJf
TkFNRX0gUFJJVkFURSAke0xJQl9OQU1FX1VDfV9TT1VSQ0UgKQogdGFyZ2V0X2NvbXBpbGVfZGVm
aW5pdGlvbnMoICR7TElCX05BTUV9IFBVQkxJQyAkPCQ8QU5EOiQ8UExBVEZPUk1fSUQ6V2luZG93
cz4sJDxTVFJFUVVBTDokPFRBUkdFVF9QUk9QRVJUWToke0xJQl9OQU1FfSxUWVBFPixTSEFSRURf
TElCUkFSWT4+OiR7TElCX05BTUVfVUN9X0RZTl9MSU5LPiApCiAKLXRhcmdldF9jb21waWxlX29w
dGlvbnMoICR7TElCX05BTUV9IFBSSVZBVEUgJDwkPE9SOiQ8Q1hYX0NPTVBJTEVSX0lEOkNsYW5n
PiwkPENYWF9DT01QSUxFUl9JRDpBcHBsZUNsYW5nPj46LVdhbGwgLVdlcnJvciAtV25vLWRlcHJl
Y2F0ZWQtcmVnaXN0ZXIgLVduby11bnVzZWQtY29uc3QtdmFyaWFibGUgLVduby11bmtub3duLWF0
dHJpYnV0ZXM+Ci0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQ8
JDxDWFhfQ09NUElMRVJfSUQ6R05VPjotV2FsbCAtV2Vycm9yIC1Xbm8tdW51c2VkLWZ1bmN0aW9u
ICAtV25vLXVudXNlZC12YXJpYWJsZSAgLVduby1zaWduLWNvbXBhcmUgIC1mZGlhZ25vc3RpY3Mt
c2hvdy1vcHRpb24gLVduby1pZ25vcmVkLWF0dHJpYnV0ZXM+Cit0YXJnZXRfY29tcGlsZV9vcHRp
b25zKCAke0xJQl9OQU1FfSBQUklWQVRFICQ8JDxPUjokPENYWF9DT01QSUxFUl9JRDpDbGFuZz4s
JDxDWFhfQ09NUElMRVJfSUQ6QXBwbGVDbGFuZz4+Oi1XYWxsIC1Xbm8tZXJyb3IgLVduby1kZXBy
ZWNhdGVkLXJlZ2lzdGVyIC1Xbm8tdW51c2VkLWNvbnN0LXZhcmlhYmxlIC1Xbm8tdW5rbm93bi1h
dHRyaWJ1dGVzPgorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAk
PCQ8Q1hYX0NPTVBJTEVSX0lEOkdOVT46LVdhbGwgLVduby1lcnJvciAtV25vLXVudXNlZC1mdW5j
dGlvbiAgLVduby11bnVzZWQtdmFyaWFibGUgIC1Xbm8tc2lnbi1jb21wYXJlICAtZmRpYWdub3N0
aWNzLXNob3ctb3B0aW9uIC1Xbm8taWdub3JlZC1hdHRyaWJ1dGVzPgogICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkPCQ8Q1hYX0NPTVBJTEVSX0lEOk1TVkM+Oi9X
NCAvV1ggL3dkNDEwMCAvd2Q0MTI3IC93ZDQyNDQgL3dkNDI0NSAvd2Q0MjUxIC93ZDQzMTAgL3dk
NDM4OSAvd2Q0NDU2IC93ZDQ0NTcgL3dkNDQ1OCAvd2Q0NDU5IC93ZDQ1MDUgL3dkNDcwMSAvd2Q0
NzAyIC93ZDQ3MDMgL3dkNDk5NiA+KQogCiBpZiggQ01BS0VfQ09NUElMRVJfSVNfR05VQ0MgQU5E
IENNQUtFX0NYWF9DT01QSUxFUl9WRVJTSU9OIFZFUlNJT05fTEVTUyA3LjAgKQoKLS0tIHNvdXJj
ZS9MaWIvdnZlbmMvdnZlbmNpbXBsLm9sZAkyMDIxLTEwLTA4IDE2OjE0OjIyLjcwMDAwMDAwMCAr
MDEwMAorKysgc291cmNlL0xpYi92dmVuYy92dmVuY2ltcGwuY3BwCTIwMjEtMTAtMDggMTY6MTk6
NDIuNDgwMDAwMDAwICswMTAwCkBAIC0yMzUsNyArMjM1LDcgQEAKICNlbmRpZgogICB9CiAKLSNp
ZiBkZWZpbmVkKCBfX2xpbnV4X18gKQorI2lmIGRlZmluZWQoIF9fbGludXhfXyApICYmICFkZWZp
bmVkKF9fQU5EUk9JRF9fKQogICBtYWxsb2NfdHJpbSgwKTsgICAvLyBmcmVlIHVudXNlZCBoZWFw
IG1lbW9yeQogI2VuZGlmCiAKQEAgLTQwMyw3ICs0MDMsNyBAQAogICAgIGlSZXQgPSB4Q29weUF1
KCAqcGNBY2Nlc3NVbml0LCBjQXUgICk7CiAgIH0KIAotI2lmIGRlZmluZWQoIF9fbGludXhfXyAp
CisjaWYgZGVmaW5lZCggX19saW51eF9fICkgJiYgIWRlZmluZWQoX19BTkRST0lEX18pCiAgIG1h
bGxvY190cmltKDApOyAgIC8vIGZyZWUgdW51c2VkIGhlYXAgbWVtb3J5CiAjZW5kaWYK
XB64_PATCH

# Filelist
# --------
# include/vvenc/vvencDecl.h
# include/vvenc/vvenc.h
# include/vvenc/version.h
# include/vvenc/vvencCfg.h
# lib/pkgconfig/libvvenc.pc
# lib/cmake/vvenc/vvencConfig.cmake
# lib/cmake/vvenc/vvencTargets-shared-release.cmake
# lib/cmake/vvenc/vvencConfigVersion.cmake
# lib/cmake/vvenc/vvencTargets-shared.cmake
# lib/libvvenc.so
# bin/vvencapp
# bin/vvencFFapp
